{% extends 'base.html' %}

{% block content %}

{% load staticfiles %}
    <div class="right_col" role="main">
      <div class="">

        <!--<div class="page-title">
          <div class="title_left">
            <h3>TRANSACCIONES</h3>
          </div>
        </div>-->
        <div class="clearfix"></div>
        <div class="row">
            <div class="col-md-9 col-sm-9 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Tabla de llegada <small></small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <form class="form-inline">
                      <div class="form-group">
                        <label>Número Corredor</label>
                        <input type="text" id="field_corre_ing" class="form-control" placeholder=" ">
                      </div>
                      <button id="btn_corre_ing" type="button" class="btn btn-default">Guardar</button>
                    </form>
                      </div>
                      <div class="x_content">
                      <div style="height:500px;overflow:auto;">
                      <table id="table1" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                          <thead>
                            <tr>
                              <th>Número</th>
                              <th>Tiempo</th>
                              <th>Nombre</th>
                              <th>Categoría</th>
                              <th>Distancia</th>
                              <th>Team</th>
                              <th>Lugar</th>
                              <th>Lugar General</th>
                            </tr>
                          </thead>
                          <tbody id="tbodycorredores">
                          </tbody>
                      </table>
                          </div>
                  </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-3 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Cronometros<small></small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                      {% for distancia in distancias %}
                    <div id="chrono-{{ distancia.id }}" class="chrono">
                       <h4> Distancia: {{ distancia.nombre }}</h4>
                        <div class="chrono-container">
                            <div class="chrono-hour">00</div>
                            <div class="chrono-divider">:</div>
                            <div class="chrono-minute">00</div>
                            <div class="chrono-divider">:</div>
                            <div class="chrono-second">00</div>
                        </div>
                        <button class="chrono-start btn btn-primary" id="{{ distancia.id }}" onclick="ingresarTime(this)">Comenzar</button>
                    </div>
                      {% endfor %}
                  </div>
                </div>
            </div>
        </div>
      </div>
    </div>
        <!-- /page content -->

    <!-- jQuery -->
    <!--<script type="text/javascript" src="{% static 'vendors/jquery/dist/jquery.min.js' %}"></script>-->
    <!--<script type="text/javascript" src="{% static 'smart-selects/admin/js/chainedfk.js' %}"></script>-->
    <!-- Bootstrap -->
    <script type="text/javascript" src="{% static 'vendors/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <!-- FastClick -->
    <script type="text/javascript" src="{% static 'vendors/fastclick/lib/fastclick.js' %}"></script>
    <!-- NProgress -->
    <script type="text/javascript" src="{% static 'vendors/nprogress/nprogress.js' %}"></script>
    <!-- bootstrap-progressbar -->
    <script type="text/javascript" src="{% static 'vendors/bootstrap-progressbar/bootstrap-progressbar.min.js' %}"></script>
    <!-- iCheck -->

    <script type="text/javascript" src="{% static 'js/datepicker/daterangepicker.js' %}"></script>
    <!-- bootstrap-wysiwyg -->
    <script type="text/javascript" src="{% static 'vendors/bootstrap-wysiwyg/js/bootstrap-wysiwyg.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/jquery.hotkeys/jquery.hotkeys.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/google-code-prettify/src/prettify.js' %}"></script>
    <!-- jQuery Tags Input -->

    <!-- Autosize -->
    <script type="text/javascript" src="{% static 'vendors/autosize/dist/autosize.min.js' %}"></script>
    <!-- jQuery autocomplete -->


    <!-- Custom Theme Scripts -->
    <script type="text/javascript" src="{% static 'js/custom.js' %}"></script>

    <script type="text/javascript" src="{% static 'js/chrono.js' %}"></script>

    <script type="text/javascript" src="{% static 'js/jquery.price_format.2.0.min.js' %}"></script>

    <script type="text/javascript" src="{% static 'vendors/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendors/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>

    <!-- bootstrap-daterangepicker -->
    <script>
      $(document).ready(function() {
        $('#datatable-responsive').DataTable();

      });

    </script>

    <script>
        {% for distancia in distancias %}
            Chrono('#chrono-{{ distancia.id }}');
        {% endfor %}

        var num = 0;
    </script>


    <!-- Autosize -->
    <script>
      $(document).ready(function() {
        autosize($('.resizable_textarea'));
      });

    </script>

    <script>

    // using jQuery
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    $('#field_corre_ing').keypress(function (e) {
         var key = e.which;
         if(key == 13)  // the enter key code
          {
            $('#btn_corre_ing').click();
            return false;
            //alert("aprete enter");
          }
    });

    $('#btn_corre_ing').on('click', function(){
        var numero = $('#field_corre_ing').val();
        if (numero !== ""){
            var datos = {"numero":parseInt(numero)};
            $.ajax({
                dataType: "json",
                url: "{% url 'getDataCorredor' %}",
                type: "POST",
                data: datos,
                success:function(data){
                    console.log(num++);
                    if(data.estado !== 0){
                        $("#tbodycorredores").prepend("<tr><td>"+numero+"</td><td>"+data.tiempo+"</td><td>"+data.nombre+" "+data.apellido_pat+"</td><td>"+data.categoria__nombre+"</td><td>"+data.distancia__nombre+"</td><td>"+data.team+"</td><td>"+data.posicion+"</td><td>"+data.posicion_gen+"</td></tr>");
                    }
                    $('#field_corre_ing').val("");
                }
            });
        }
    });

    function ingresarTime(elem){
        var id_dis = $(elem).attr("id");
        var datos = {"id_dis":parseInt(id_dis)};
            $.ajax({
                dataType: "json",
                url: "{% url 'setTimeInicio' %}",
                type: "POST",
                data: datos,
                success:function(data){
                    console.log(data.time);
                }
            });
    }

    </script>


{% endblock %}